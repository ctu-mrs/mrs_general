<launch>

  <arg name="uav_name" default="$(optenv UAV_NAME uav)"/>

  <group ns="$(arg uav_name)">

    <!-- Mobius -->
    <node name="mobius" pkg="usb_cam" type="usb_cam_node" output="screen" >

      <param name="camera_name" value="mobius" />
      <param name="video_device" value="/dev/video0" />
      <param name="image_width" value="1280" />
      <param name="image_height" value="720" />
      <param name="pixel_format" value="mjpeg" />
      <param name="camera_frame_id" value="usb_cam" />
      <param name="io_method" value="mmap"/>
      <param name="camera_info_url" type="string" value="file://${ROS_HOME}/camera_info/mobius.yaml"/>

      <!-- Params for mjpeg quality -->
      <param name="image_raw/compressed/jpeg_quality" value="90" />

      <!-- Params for theora quality, images being compressed into "stream" -->
      <param name="image_raw/theora/keyframe_frequency" value="60" />
      <param name="image_raw/theora/target_bitrate" value="50000" />
      <param name="image_raw/theora/quality" value="9" />
      <param name="image_raw/theora/optimize_for" value="0" />

    </node>

    <!-- Bluefox2  -->
    <arg name="device" default="$(env BLUEFOX)"/>
    <arg name="rate" default="50"/>

    <!-- Camera Settings -->
    <arg name="serial" default="$(arg device)"/>
    <arg name="camera_name" default="bluefox"/>
    <arg name="camera" default="$(arg camera_name)"/>
    <arg name="frame_id" default="$(arg camera)"/>
    <arg name="calib_url" default="file://$(find mrs_main)/camera_info/bluefox_$(arg uav_name).yaml"/>
    <arg name="fps" default="$(arg rate)"/>

    <arg name="idpf" default="0"/>
    <arg name="aec" default="true"/>
    <arg name="expose_us" default="10000"/>
    <arg name="agc" default="true"/>
    <arg name="gain_db" default="0.0"/>
    <arg name="cbm" default="0"/>
    <arg name="ctm" default="1"/>
    <arg name="dcfm" default="0"/>
    <arg name="hdr" default="false"/>
    <arg name="wbp" default="-1"/>
    <arg name="request" default="0"/>
    <arg name="mm" default="0"/>
    <arg name="jpeg_quality" default="90"/>

    <!-- Node Settings -->
    <arg name="output" default="screen"/>
    <arg name="proc" default="false"/>
    <arg name="view" default="false"/>
    <arg name="calib" default="false"/>

    <!-- Node -->
    <node pkg="bluefox2" type="bluefox2_single_node" name="bluefox" output="$(arg output)">
      <param name="identifier" type="string" value="$(arg serial)"/>
      <param name="frame_id" type="string" value="$(arg frame_id)"/>
      <param name="camera_name" type="string" value="$(arg camera_name)"/>
      <param name="calib_url" type="string" value="$(arg calib_url)"/>
      <param name="fps" type="double" value="$(arg fps)"/>
      <param name="idpf" type="int" value="$(arg idpf)"/>
      <param name="aec" type="bool" value="$(arg aec)"/>
      <param name="expose_us" type="int" value="$(arg expose_us)"/>
      <param name="agc" type="bool" value="$(arg agc)"/>
      <param name="gain_db" type="double" value="$(arg gain_db)"/>
      <param name="cbm" type="int" value="$(arg cbm)"/>
      <param name="ctm" type="int" value="$(arg ctm)"/>
      <param name="dcfm" type="int" value="$(arg dcfm)"/>
      <param name="hdr" type="bool" value="$(arg hdr)"/>
      <param name="wbp" type="int" value="$(arg wbp)"/>
      <param name="request" type="int" value="$(arg request)"/>
      <param name="mm" type="int" value="$(arg mm)"/>

      <!-- Params for theora quality, images being compressed into "stream" -->
      <param name="image_raw/compressed/jpeg_quality" type="int" value="$(arg jpeg_quality)"/>
      <param name="image_raw/theora/keyframe_frequency" value="60" />
      <param name="image_raw/theora/target_bitrate" value="50000" />
      <param name="image_raw/theora/quality" value="8" />
      <param name="image_raw/theora/optimize_for" value="0" />
    </node>
  </group>
</launch>
